# üöó CAR IMPORT PLATFORM - COMPLETE ARCHITECTURE & ROADMAP

**Version:** 1.0.0  
**Last Updated:** January 19, 2026  
**Status:** In Development

---

## üìã TABLE OF CONTENTS

1. [Executive Summary](#executive-summary)
2. [Business Model](#business-model)
3. [Technical Stack](#technical-stack)
4. [System Architecture](#system-architecture)
5. [Database Schema](#database-schema)
6. [Feature Specifications](#feature-specifications)
7. [Design System](#design-system)
8. [Security & Compliance](#security--compliance)
9. [Development Roadmap](#development-roadmap)
10. [Deployment Strategy](#deployment-strategy)
11. [Marketing Integration](#marketing-integration)
12. [Escrow System](#escrow-system)

---

## üéØ EXECUTIVE SUMMARY

### Vision
Build East Africa's most trusted and technologically advanced car import platform, combining Fortune 500-level design with glassmorphism aesthetics to create an unparalleled user experience.

### Mission
Democratize car importing by providing transparent pricing, seamless logistics, and professional service that makes importing from Dubai accessible to every Ugandan.

### Core Value Propositions
- **15-20% Cost Savings** vs local dealerships
- **Full Transparency** - Complete cost breakdown
- **3-5 Week Delivery** - Predictable timeline
- **Quality Guarantee** - Inspection reports & warranty
- **Escrow Protection** - Lawyer-held funds for trust

---

## üíº BUSINESS MODEL

### Revenue Streams

#### 1. Direct Import & Retail (Primary)
- Purchase vehicles in Dubai
- Import to Kampala
- Sell at markup
- **Profit:** UGX 10-20M per vehicle

#### 2. Pre-Order Service
- Client selects car from Dubai inventory
- We import on their behalf (40% deposit)
- Lower risk, faster turnover
- **Profit:** UGX 5-10M per vehicle

#### 3. Corporate Fleet Solutions
- Bulk orders (3-10+ vehicles)
- Lower margins, higher volume
- Professional procurement process
- **Profit:** UGX 5-8M per vehicle

#### 4. Ancillary Services
- Inspection & documentation: UGX 500K-1M
- Trade-in facilitation: Commission-based
- After-sales warranty: UGX 300K-500K
- Financing referrals: 2-3% commission

### Customer Segments

**Segment 1: Individual Buyers (Priority 1)**
- Demographics: 28-45 years, professionals
- Budget: UGX 40-100M
- Volume: 40-50 cars/year
- Conversion: Fast (1-2 weeks)

**Segment 2: Diaspora Buyers (Priority 2)**
- Demographics: Ugandans in US/UK/UAE
- Buying for family in Uganda
- Volume: 20-30 cars/year
- Conversion: Medium (2-4 weeks)
- Requires: Extra trust, documentation

**Segment 3: Corporate/NGO (Priority 3)**
- Demographics: Companies, NGOs, government
- Volume: 10-20 cars/year
- Conversion: Slow (4-8 weeks)
- Requires: Professional proposals, compliance

---

## üõ† TECHNICAL STACK

### Frontend

```yaml
Framework: Next.js 14+
  - App Router (latest routing system)
  - Server Components (performance)
  - Server Actions (API simplification)
  
Language: TypeScript 5+
  - Full type safety
  - Better developer experience
  - Reduced bugs

Styling: 
  - Tailwind CSS 3.4+ (utility-first)
  - Framer Motion (animations)
  - Custom glassmorphism components
  
UI Components:
  - Shadcn/ui (headless components)
  - Radix UI (accessible primitives)
  - Lucide Icons (modern icon set)
  
3D/Advanced:
  - Three.js (3D vehicle viewer)
  - React Three Fiber (React wrapper)
  - GSAP (complex animations)
```

### Backend

```yaml
API: Next.js API Routes
  - Serverless functions
  - Edge runtime support
  - Type-safe with TypeScript

Database: Supabase (PostgreSQL)
  - Real-time subscriptions
  - Row Level Security (RLS)
  - Built-in authentication
  - Storage for images/documents
  
ORM: Prisma
  - Type-safe database queries
  - Auto-generated types
  - Migration management
  
Cache: Vercel Edge Cache
  - Global CDN
  - Automatic cache invalidation
```

### Third-Party Integrations

```yaml
Payments:
  - Flutterwave (Mobile Money, cards)
  - Stripe (international cards)
  - Bank transfer webhooks

Communication:
  - WhatsApp Business API
  - Twilio (SMS notifications)
  - Resend/SendGrid (emails)
  
AI/ML:
  - Claude API (chatbot, recommendations)
  - OpenAI DALL-E (placeholder images)
  
Analytics:
  - Google Analytics 4
  - Hotjar (heatmaps, recordings)
  - Microsoft Clarity (session replay)
  - PostHog (product analytics)
  
Maps & Location:
  - Google Maps API
  - Mapbox (custom styling)
  
Search:
  - Algolia (instant search) OR
  - Meilisearch (self-hosted alternative)
  
CRM:
  - Custom built (Phase 2) OR
  - Pipedrive API integration
```

### DevOps & Infrastructure

```yaml
Hosting: Vercel
  - Automatic deployments
  - Preview environments
  - Edge functions
  - 99.99% uptime SLA
  
CDN: Cloudflare
  - DDoS protection
  - Image optimization
  - Edge caching
  
Storage:
  - Supabase Storage (documents, invoices)
  - Cloudflare R2 (vehicle images)
  
Monitoring:
  - Sentry (error tracking)
  - Vercel Analytics (web vitals)
  - Uptime Robot (uptime monitoring)
  
Version Control: GitHub
  - Main branch (production)
  - Develop branch (staging)
  - Feature branches (development)
```

---

## üèó SYSTEM ARCHITECTURE

### High-Level Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CLIENT LAYER                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Desktop ‚îÇ  ‚îÇ  Mobile  ‚îÇ  ‚îÇ  Tablet  ‚îÇ  ‚îÇ   PWA    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     CDN LAYER (Cloudflare)                   ‚îÇ
‚îÇ              Static Assets, Images, Edge Cache               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  APPLICATION LAYER (Next.js)                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ   Frontend   ‚îÇ  ‚îÇ  API Routes  ‚îÇ  ‚îÇServer Actions‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  Components  ‚îÇ  ‚îÇ  (REST/API)  ‚îÇ  ‚îÇ   (Mutations)‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      SERVICE LAYER                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ   Auth   ‚îÇ  ‚îÇ  Payment ‚îÇ  ‚îÇ    AI    ‚îÇ  ‚îÇNotification‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Service  ‚îÇ  ‚îÇ Service  ‚îÇ  ‚îÇ Service  ‚îÇ  ‚îÇ  Service   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      DATA LAYER                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ   Supabase   ‚îÇ  ‚îÇ    Redis     ‚îÇ  ‚îÇ   Storage    ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  PostgreSQL  ‚îÇ  ‚îÇ    Cache     ‚îÇ  ‚îÇ   (R2/S3)    ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  EXTERNAL INTEGRATIONS                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇFlutterwave‚îÇ ‚îÇ WhatsApp ‚îÇ  ‚îÇ  Claude  ‚îÇ  ‚îÇ  Google  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ          ‚îÇ  ‚îÇ   API    ‚îÇ  ‚îÇ   API    ‚îÇ  ‚îÇ   APIs   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Folder Structure

```
car-import-platform/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ci.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy-production.yml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ deploy-staging.yml
‚îÇ   ‚îî‚îÄ‚îÄ ISSUE_TEMPLATE/
‚îÇ
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ videos/
‚îÇ   ‚îú‚îÄ‚îÄ fonts/
‚îÇ   ‚îî‚îÄ‚îÄ robots.txt
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                      # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (marketing)/          # Marketing pages (no auth)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx          # Homepage
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ about/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ how-it-works/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ contact/
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventory/            # Vehicle listings
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx          # Grid view
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [slug]/           # Vehicle detail
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ compare/          # Comparison tool
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-order/            # Pre-order flow
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ corporate/            # Corporate solutions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ financing/            # Financing info
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ testimonials/         # Customer reviews
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blog/                 # Blog/articles
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [slug]/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ category/[category]/
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/               # Authenticated routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ portal/           # Customer portal
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orders/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/            # Admin dashboard
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ vehicles/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ orders/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ leads/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ content/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ analytics/
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                  # API Routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vehicles/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orders/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ escrow/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chatbot/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ contact/
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx            # Root layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css           # Global styles
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error.tsx             # Error boundary
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/               # React components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                   # Shadcn components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Sidebar.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vehicles/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VehicleCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VehicleGrid.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VehicleDetail.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImageGallery.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Viewer360.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ComparisonTable.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forms/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ContactForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ReserveForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PreOrderForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FinancingCalculator.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SearchBar.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FilterPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PriceCalculator.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chatbot.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoadingSpinner.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ErrorBoundary.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ animations/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ FadeIn.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SlideIn.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Parallax.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ lib/                      # Utilities & configs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queries.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ client.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cn.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validators.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ escrow.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analytics.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ routes.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ config.ts
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ makes-models.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ types/                    # TypeScript types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vehicle.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                    # Custom React hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useVehicles.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSearch.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useFilters.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useToast.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ styles/                   # Additional styles
‚îÇ       ‚îú‚îÄ‚îÄ glassmorphism.css
‚îÇ       ‚îî‚îÄ‚îÄ animations.css
‚îÇ
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma             # Database schema
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ seed.ts                   # Seed database
‚îÇ   ‚îú‚îÄ‚îÄ scrape-dubai.ts           # Scrape Dubai listings
‚îÇ   ‚îî‚îÄ‚îÄ backup.ts                 # Database backup
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ API.md
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md
‚îÇ   ‚îú‚îÄ‚îÄ CONTRIBUTING.md
‚îÇ   ‚îî‚îÄ‚îÄ CHANGELOG.md
‚îÇ
‚îú‚îÄ‚îÄ .env.local                    # Environment variables
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .eslintrc.json
‚îú‚îÄ‚îÄ .prettierrc
‚îú‚îÄ‚îÄ next.config.js
‚îú‚îÄ‚îÄ tailwind.config.ts
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ ARCHITECTURE.md               # This file
```

---

## üóÑ DATABASE SCHEMA

### Entity Relationship Diagram

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Users    ‚îÇ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  Vehicles   ‚îÇ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   Orders    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id          ‚îÇ   ‚îÇ   ‚îÇ id          ‚îÇ   ‚îÇ   ‚îÇ id          ‚îÇ
‚îÇ email       ‚îÇ   ‚îÇ   ‚îÇ make        ‚îÇ   ‚îÇ   ‚îÇ user_id     ‚îÇ
‚îÇ name        ‚îÇ   ‚îÇ   ‚îÇ model       ‚îÇ   ‚îÇ   ‚îÇ vehicle_id  ‚îÇ
‚îÇ phone       ‚îÇ   ‚îî‚îÄ‚îÄ>‚îÇ year        ‚îÇ   ‚îî‚îÄ‚îÄ>‚îÇ status      ‚îÇ
‚îÇ role        ‚îÇ       ‚îÇ price       ‚îÇ       ‚îÇ deposit     ‚îÇ
‚îÇ created_at  ‚îÇ       ‚îÇ location    ‚îÇ       ‚îÇ total       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ status      ‚îÇ       ‚îÇ escrow_id   ‚îÇ
                      ‚îÇ images[]    ‚îÇ       ‚îÇ created_at  ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ                      ‚îÇ
                             ‚Üì                      ‚Üì
                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                      ‚îÇ   Images    ‚îÇ       ‚îÇ   Escrow    ‚îÇ
                      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                      ‚îÇ id          ‚îÇ       ‚îÇ id          ‚îÇ
                      ‚îÇ vehicle_id  ‚îÇ       ‚îÇ order_id    ‚îÇ
                      ‚îÇ url         ‚îÇ       ‚îÇ lawyer_name ‚îÇ
                      ‚îÇ order       ‚îÇ       ‚îÇ amount      ‚îÇ
                      ‚îÇ is_primary  ‚îÇ       ‚îÇ status      ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ released_at ‚îÇ
                                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Prisma Schema

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER MANAGEMENT
// ============================================

enum UserRole {
  CUSTOMER
  ADMIN
  SALES_AGENT
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  phone         String?   @unique
  name          String
  role          UserRole  @default(CUSTOMER)
  avatarUrl     String?
  
  // Customer-specific
  location      String?
  preferences   Json?     // Car preferences
  
  // Relations
  orders        Order[]
  savedVehicles SavedVehicle[]
  messages      Message[]
  reviews       Review[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("users")
}

// ============================================
// VEHICLE INVENTORY
// ============================================

enum VehicleStatus {
  IN_STOCK_KAMPALA
  IN_STOCK_DUBAI
  RESERVED
  IN_TRANSIT
  SOLD
  UNAVAILABLE
}

enum VehicleLocation {
  KAMPALA
  DUBAI
  MOMBASA
  IN_TRANSIT
}

enum Transmission {
  AUTOMATIC
  MANUAL
}

enum FuelType {
  PETROL
  DIESEL
  HYBRID
  ELECTRIC
}

enum BodyType {
  SEDAN
  SUV
  HATCHBACK
  COUPE
  WAGON
  VAN
  PICKUP
}

model Vehicle {
  id              String          @id @default(cuid())
  slug            String          @unique
  
  // Basic Info
  make            String
  model           String
  year            Int
  vin             String?         @unique
  
  // Specifications
  mileage         Int             // in kilometers
  engineSize      Float           // in liters
  transmission    Transmission
  fuelType        FuelType
  bodyType        BodyType
  color           String
  seats           Int             @default(5)
  doors           Int             @default(4)
  
  // Pricing
  dubaiPrice      Decimal         @db.Decimal(12, 2)
  shippingCost    Decimal         @db.Decimal(12, 2)
  customsDuty     Decimal         @db.Decimal(12, 2)
  otherFees       Decimal         @db.Decimal(12, 2)
  totalLandedCost Decimal         @db.Decimal(12, 2)
  sellingPrice    Decimal         @db.Decimal(12, 2)
  
  // Location & Status
  location        VehicleLocation
  status          VehicleStatus   @default(IN_STOCK_DUBAI)
  
  // Features
  features        String[]        // ["Leather Seats", "Sunroof", etc]
  description     String?         @db.Text
  
  // Inspection
  inspectionReport String?        // URL to PDF
  inspectionDate   DateTime?
  inspectedBy      String?
  
  // Media
  images          VehicleImage[]
  videos          String[]        // Video URLs
  
  // SEO
  metaTitle       String?
  metaDescription String?
  
  // Relations
  orders          Order[]
  savedBy         SavedVehicle[]
  reviews         Review[]
  
  // Timestamps
  arrivedAt       DateTime?       // When it arrived in Kampala
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([make, model, year])
  @@index([status, location])
  @@index([sellingPrice])
  @@map("vehicles")
}

model VehicleImage {
  id         String   @id @default(cuid())
  vehicleId  String
  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  url        String
  alt        String?
  order      Int      @default(0)
  isPrimary  Boolean  @default(false)
  
  createdAt  DateTime @default(now())
  
  @@index([vehicleId])
  @@map("vehicle_images")
}

model SavedVehicle {
  id        String   @id @default(cuid())
  userId    String
  vehicleId String
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([userId, vehicleId])
  @@map("saved_vehicles")
}

// ============================================
// ORDERS & PAYMENTS
// ============================================

enum OrderStatus {
  INQUIRY
  QUOTED
  DEPOSIT_PENDING
  DEPOSIT_PAID
  IN_ESCROW
  VEHICLE_ORDERED
  IN_TRANSIT
  ARRIVED_KAMPALA
  READY_FOR_INSPECTION
  INSPECTION_APPROVED
  FINAL_PAYMENT_PENDING
  FINAL_PAYMENT_PAID
  COMPLETED
  CANCELLED
  REFUNDED
}

enum OrderType {
  RETAIL              // Buy existing stock
  PRE_ORDER           // Import specific car
  CORPORATE           // Fleet deal
}

model Order {
  id             String       @id @default(cuid())
  orderNumber    String       @unique // e.g., "ORD-2026-0001"
  
  // Relationships
  userId         String
  user           User         @relation(fields: [userId], references: [id])
  vehicleId      String
  vehicle        Vehicle      @relation(fields: [vehicleId], references: [id])
  
  // Order Details
  type           OrderType    @default(RETAIL)
  status         OrderStatus  @default(INQUIRY)
  
  // Pricing
  vehiclePrice   Decimal      @db.Decimal(12, 2)
  depositAmount  Decimal      @db.Decimal(12, 2)
  finalAmount    Decimal      @db.Decimal(12, 2)
  totalAmount    Decimal      @db.Decimal(12, 2)
  
  // Payment Tracking
  depositPaidAt  DateTime?
  finalPaidAt    DateTime?
  
  // Escrow
  escrow         Escrow?
  
  // Timeline
  estimatedDelivery DateTime?
  actualDelivery    DateTime?
  
  // Documents
  invoiceUrl     String?
  contractUrl    String?
  
  // Notes
  customerNotes  String?      @db.Text
  internalNotes  String?      @db.Text
  
  // Relations
  payments       Payment[]
  messages       Message[]
  timeline       OrderTimeline[]
  
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  @@index([userId])
  @@index([status])
  @@index([orderNumber])
  @@map("orders")
}

enum EscrowStatus {
  PENDING           // Funds not yet deposited
  DEPOSITED         // Funds held by lawyer
  VEHICLE_RECEIVED  // Customer received vehicle
  INSPECTION_PASSED // Customer approved vehicle
  RELEASED          // Funds released to seller
  REFUNDED          // Funds returned to customer
}

model Escrow {
  id             String        @id @default(cuid())
  orderId        String        @unique
  order          Order         @relation(fields: [orderId], references: [id])
  
  // Lawyer Details
  lawyerName     String
  lawyerEmail    String
  lawyerPhone    String
  lawFirm        String
  
  // Escrow Account
  accountNumber  String
  bankName       String
  
  // Amount
  amount         Decimal       @db.Decimal(12, 2)
  currency       String        @default("UGX")
  
  // Status
  status         EscrowStatus  @default(PENDING)
  
  // Timeline
  depositedAt    DateTime?
  releasedAt     DateTime?
  
  // Documents
  agreementUrl   String?       // Escrow agreement PDF
  releaseFormUrl String?       // Customer sign-off
  
  // Notes
  notes          String?       @db.Text
  
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  
  @@map("escrow")
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  MOBILE_MONEY
  BANK_TRANSFER
  CREDIT_CARD
  CASH
  ESCROW
}

model Payment {
  id              String         @id @default(cuid())
  orderId         String
  order           Order          @relation(fields: [orderId], references: [id])
  
  // Payment Details
  amount          Decimal        @db.Decimal(12, 2)
  currency        String         @default("UGX")
  method          PaymentMethod
  status          PaymentStatus  @default(PENDING)
  
  // External Reference
  transactionId   String?        @unique
  providerRef     String?        // Flutterwave/Stripe reference
  
  // Metadata
  phoneNumber     String?        // For mobile money
  accountNumber   String?        // For bank transfer
  receiptUrl      String?
  
  // Timestamps
  paidAt          DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  @@index([orderId])
  @@index([status])
  @@map("payments")
}

model OrderTimeline {
  id          String   @id @default(cuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  status      String   // e.g., "Deposit Paid", "Vehicle Shipped"
  description String?  @db.Text
  
  createdAt   DateTime @default(now())
  
  @@index([orderId])
  @@map("order_timeline")
}

// ============================================
// COMMUNICATIONS
// ============================================

enum MessageStatus {
  SENT
  DELIVERED
  READ
  FAILED
}

model Message {
  id         String        @id @default(cuid())
  orderId    String?
  order      Order?        @relation(fields: [orderId], references: [id])
  userId     String
  user       User          @relation(fields: [userId], references: [id])
  
  content    String        @db.Text
  isFromUser Boolean       @default(true)
  status     MessageStatus @default(SENT)
  
  createdAt  DateTime      @default(now())
  readAt     DateTime?
  
  @@index([orderId])
  @@index([userId])
  @@map("messages")
}

// ============================================
// REVIEWS & TESTIMONIALS
// ============================================

model Review {
  id         String   @id @default(cuid())
  vehicleId  String
  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  
  rating     Int      // 1-5 stars
  title      String?
  comment    String   @db.Text
  
  // Media
  images     String[] // Photo URLs
  videoUrl   String?
  
  // Moderation
  isApproved Boolean  @default(false)
  isPublic   Boolean  @default(true)
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  @@index([vehicleId])
  @@index([userId])
  @@map("reviews")
}

// ============================================
// BLOG & CONTENT
// ============================================

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model BlogPost {
  id              String     @id @default(cuid())
  slug            String     @unique
  
  title           String
  excerpt         String     @db.Text
  content         String     @db.Text
  featuredImage   String?
  
  // SEO
  metaTitle       String?
  metaDescription String?
  keywords        String[]
